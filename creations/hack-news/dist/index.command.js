"use strict";(()=>{var o;(function(t){t.Render="Render",t.InitOnFilterChange="InitOnFilterChange",t.OnFilterChange="OnFilterChange",t.InitOnSearchChange="InitOnSearchChange",t.OnSearchChange="OnSearchChange"})(o||(o={}));function u(t){return t.type==="CustomAction"}function d(t){return t?.type==="customAction"&&Reflect.has(t,"itemIndex")}function p(t){return t?.type==="onItemSelect"}var i=class{constructor(a){this.setState=n=>{let e=n?.items?.length?!1:this.state.isLoading;this.state={...this.state,isLoading:e,...n},this.render()},this.onSelectItem=n=>(this.onItemSelectCallback=n,this),this.run=()=>(this.render(),self.addEventListener("message",async n=>{if(d(n.data)){let s=this.state.items[n.data.itemIndex].actions[n.data.actionIndex];u(s)&&s.onClick?.()}if(p(n.data)){let e=this.state.items[n.data.itemIndex];if(typeof e.detail=="function"){postMessage({type:"detail",isLoading:!0,data:[]});let s=await e.detail();postMessage({type:"detail",isLoading:!1,data:s})}}}),this),this.render=()=>{postMessage({type:o.Render,payload:{type:"list",...this.formatState(this.state)}})},this.state={items:[],isLoading:!1,filtering:!0,titleLayout:"row",isShowingDetail:!1,...a}}formatState(a){let n=a.items.map(e=>({...e,detail:typeof e.detail=="function"?"functionDetail":e.detail,actions:e.actions?.map(s=>{if(!u(s))return s;let{onClick:c,...r}=s;return r})}));return{...this.state,items:n}}};async function l(t){let a=`https://hacker-news.firebaseio.com/v0/${t}stories.json`;return await fetch(a).then(e=>e.json()).then(e=>{let s=e.slice(0,20).map(c=>fetch(`https://hacker-news.firebaseio.com/v0/item/${c}.json`).then(r=>r.json()));return Promise.all(s)})}async function h(){let t=new i({isLoading:!0,items:[]}).run();m().then(a=>{t.setState({items:a})})}async function m(t="top"){return(await l(t)).map((e,s)=>({icon:s+1,title:e.title,actions:[{type:"OpenInBrowser",url:e.url}],extra:[{icon:"comment.svg",text:e.descendants||0},{icon:"up.svg",text:e.score||0}]}))}h();})();

"undefined"!=typeof document&&document.addEventListener("keydown",e=>{"Escape"!==e.key||window.$__IS_ACTION_OPEN__||window.parent.postMessage({type:"escape"},"*")});
